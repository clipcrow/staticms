# User Stories

Staticms の主要なユーザー体験を定義したストーリーです。これらは E2E
テストのシナリオベースとなります。

## US-01: 認証とセットアップ

**As a** ユーザー **I want to** GitHub アカウントで安全にログインする **So
that** 自分のリポジトリにアクセスして編集作業を開始できる

### Scenarios

1. **強制リダイレクト認証**:
   - ユーザーが未認証状態でトップページ (`/`) にアクセスする。
   - システムは自動的に GitHub の OAuth 認可画面 (`/api/auth/login` 経由)
     へリダイレクトする。
   - （GitHub側での承認プロセス）
   - 承認後、コールバックを経て Staticms
     のトップページ（リポジトリ選択画面）が表示される。
2. **リポジトリの認識**:
   - ログイン後、Staticms は自分がアクセス可能な（GitHub App
     がインストールされた）リポジトリの一覧を表示する。

## US-02: リポジトリとコンテンツの選択

**As a** ユーザー **I want to** 編集したいコンテンツを素早く見つける **So that**
迷うことなく作業を開始できる

### Scenarios

1. **リポジトリ選択**:
   - リストからリポジトリを選択すると、そのリポジトリ内の編集可能なコンテンツ一覧（ブログ記事、固定ページ設定など）が表示される。
2. **記事一覧表示**:
   - 「ブログ」などのコレクションを選択すると、既存の記事一覧が表示される。
   - ここには GitHub
     上の公開記事だけでなく、**手元で書きかけの（まだ保存していない）ドラフト記事**
     も統合して表示される。

## US-03: コンテンツの編集とドラフト保存

**As a** ユーザー **I want to**
保存ボタンを押すことを意識せずに自由に執筆し、作業を中断・再開できる **So that**
ネットワーク切断やブラウザクラッシュによるデータ消失を恐れずに作業できる

### Scenarios

1. **自動保存（ドラフト）**:
   - エディタで文字を入力するたびに、内容は自動的にブラウザ内に保存される。
   - サーバーやGitHubにはまだ何も送信されない。
   - 意図せずタブを閉じたりリロードしたりしても、再び開くと編集中の内容が即座に復元される。
2. **画像の追加**:
   - エディタ、またはサイドバーに画像をドラッグ＆ドロップすると、画像が即座にプレビューされる。
   - 画像もドラフトの一部として扱われ、GitHubにアップロードされるまではローカルにのみ存在する。

## US-04: 変更の公開 (Pull Request)

**As a** コンテンツ作成者 **I want to** 編集した内容を安全に提案する **So that**
チームメンバーがレビューしてから公開できる

### Scenarios

1. **保存とPR作成**:
   - 「Save」ボタンを押すと、ドラフト内容（画像含む）がアップロードされる。
   - システムは自動的に新しいブランチを作成し、Pull Request (PR) を作成する。
   - 画面上には「Unsaved Changes」の代わりに「PR Open:
     #123」のようなリンクが表示され、GitHub上でプレビュー可​​能になる。
2. **継続的な編集**:
   - PR作成後も、エディタでさらに修正を加えることができる。
   - 再度「Save」を押すと、既存のPRに対して追加のコミットが行われる。

## US-05: リアルタイム同期と競合回避

**As a** ユーザー **I want to** 他のメンバーの更新をすぐに知る **So that**
古いファイルを編集してしまう無駄を防ぐ

### Scenarios

1. **Push通知**:
   - 他の誰かがリポジトリを更新（Push）すると、エディタを開いている自分の画面に通知が届く。
   - もし自分がまだ何も編集していなければ、画面は自動的に最新の内容にリフレッシュされる。
   - もし自分が編集中であれば、リフレッシュは保留され、競合の可能性があることを知ることができる。

## US-06: 新規記事の作成

**As a** ユーザー **I want to** 新しい記事をゼロから書き始める **So that**
アイデアをすぐに形にできる

### Scenarios

1. **新規作成**:
   - コンテンツ一覧画面で「New」ボタンを押す。
   - 空のエディタが開き、執筆を開始できる。
   - この時点では GitHub
     上にファイルは一切作られない（ゴミファイルを増やさない）。
   - 執筆して「Save」を押した瞬間に初めてファイルとブランチ、PRが作成される。
