# Staticms ユーザーガイド

Staticms は、GitHub
リポジトリをデータベースとして利用する、開発者に優しいヘッドレス CMS です。
専門的な知識がなくても、直感的な UI で Markdown
記事の執筆や画像の管理が行えます。

## 目次

1. [ログインと開始](#1-ログインと開始)
2. [コンテンツの管理](#2-コンテンツの管理)
3. [記事の編集](#3-記事の編集)
   - [エディタ画面の構成](#エディタ画面の構成)
   - [画像のアップロードと挿入](#画像のアップロードと挿入)
   - [ドラフト（自動保存）機能](#ドラフト自動保存機能)
4. [保存と公開](#4-保存と公開)
5. [設定ファイル (staticms.yml)](#5-設定ファイル-staticmsyml)

---

## 1. ログインと開始

Staticms のトップページにアクセスすると、GitHub
認証画面へリダイレクトされます（初回のみ）。
「Authorize」ボタンを押して、Staticms
があなたのリポジトリにアクセスすることを許可してください。

ログインに成功すると、**リポジトリ選択画面** が表示されます。 Staticms
をインストール済みのリポジトリ一覧から、編集したいサイトのリポジトリを選択してください。

## 2. コンテンツの管理

リポジトリを選択すると、そのリポジトリで管理されている**コンテンツタイプ（Collection）**の一覧が表示されます。
（例: Blog Posts, News, Pages など）

編集したいカテゴリ（Collection）をクリックすると、**記事一覧画面**が表示されます。

- **新規作成**: 右上の「New」ボタンから新しい記事を作成できます。
- **編集**: 一覧から記事タイトルをクリックして編集画面を開きます。

## 3. 記事の編集

### エディタ画面の構成

エディタ画面は以下の3つのエリアで構成されています。

1. **ヘッダー**: パンくずリストや、「Save / Create PR」ボタンがあります。
2. **メタデータ設定 (Frontmatter)**:
   タイトル、日付、タグなどの記事情報を入力するフォームです。
3. **本文エディタ**: Markdown
   形式で本文を執筆するエリアです。プレビューモードへの切り替えも可能です。

### 画像のアップロードと挿入

記事内に画像を挿入するには、以下の簡単な操作で可能です。

1. **ドラッグ＆ドロップ**:
   画像ファイルをエディタのテキストエリア（Markdown入力欄）に直接ドロップします。
2. **自動リンク挿入**: ドロップすると、即座に Markdown 形式の画像リンク
   `![filename.png](filename.png)` が挿入されます。
3. **プレビュー**:
   「Preview」タブに切り替えると、アップロードした画像が即座に表示されます。

※ 画像は記事一覧画面のサイドバーにある「Pending
Images」にも表示され、記事の保存時に一緒にGitHubへアップロードされます。

### ドラフト（自動保存）機能

執筆中の内容は、**ブラウザ内に自動的に保存（ドラフト）**されます。

- **安心の執筆**:
  誤ってブラウザを閉じたり、リロードしても、内容は消えません。次回アクセス時に「Draft
  Restored」と表示され、続きから執筆できます。
- **リセット機能**:
  サーバー上の最新の状態に戻したい（下書きを破棄したい）場合は、ヘッダーの「Reset」ボタンを押してください。

## 4. 保存と公開

書き終わったら、ヘッダー右上の **「Save / Create PR」** ボタンを押してください。

1. **Pull Request (PR) の作成**:
   - あなたの変更内容は、新しい「Pull Request」として GitHub に送信されます。
   - まだ本番サイトには反映されず、レビュー待ちの状態になります。
2. **ロック機能**:
   - PR が作成されると、その記事は「**Locked (PR Open)**」状態になり、PR
     がマージまたはクローズされるまで再編集できなくなります。
   - これにより、チーム開発時の編集競合を防ぎます。
3. **公開**:
   - GitHub 上で PR をマージすると、本番サイトに変更が反映され、Staticms
     上のロックも解除されます。

## 5. 設定ファイル (staticms.yml)

Staticms を動作させるには、リポジトリの `.github/staticms.yml`
に設定ファイルを配置する必要があります。

### 設定例

```yaml
config:
  # 画像の保存先
  media_folder: "public/images/uploads"
  public_folder: "/images/uploads"

collections:
  - name: "posts" # システム上の識別子
    label: "Blog Posts" # 表示名
    folder: "content/posts" # 記事ファイルの保存先フォルダ
    create: true # 新規作成を許可するか
    slug: "{{slug}}" # ファイル名のルール
    fields: # 入力項目定義
      - { label: "Title", name: "title", widget: "string" }
      - { label: "Publish Date", name: "date", widget: "datetime" }
      - { label: "Body", name: "body", widget: "markdown" }
```

### 主なフィールドタイプ (Widget)

- `string`: 1行テキスト入力
- `text`: 複数行テキスト入力
- `markdown`: 本文入力用リッチエディタ
- `datetime`: 日時選択
- `boolean`: ON/OFF スイッチ
- `image`: 画像選択（標準アップローダー使用時）
